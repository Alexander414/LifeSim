<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Life Loop Prototype v4</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<header>
  <div class="row">
    <div>
      <h1>Life Loop Prototype <span class="sub">(v4 modular HTML/JS)</span></h1>
      <div class="sub">Kingdom map, travel, hidden content by age, and dynamic caravan events.</div>
    </div>
    <div class="kpi" id="topKpi"></div>
  </div>
</header>

<main>
  <div id="screenLanding" class="grid">
    <section class="card">
      <h2>New Life Setup</h2>
      <div class="small">You have <span class="hl" id="metaPoints">0</span> meta points. Your kingdom progress persists across lives.</div>

      <div class="divider"></div>

      <div class="row">
        <div>
          <label>Name</label>
          <input id="inpName" type="text" maxlength="20" placeholder="e.g., Alex" />
        </div>
        <div>
          <label>Gender</label>
          <select id="selGender">
            <option value="male">Male</option>
            <option value="female">Female</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Family Name (required)</label>
          <input id="inpFamilyName" type="text" maxlength="18" placeholder="e.g., Valen" />
          <div class="small">If blank, one will be generated.</div>
        </div>
        <div>
          <label>Origin Background</label>
          <select id="selFamily"></select>
          <div class="small" id="familyDesc"></div>
        </div>
      </div>

      <div class="divider"></div>

      <h2>Base Skills (Spend points)</h2>
      <div class="small">Each point gives a small start bonus. You may keep points unspent.</div>
      <div class="split">
        <div>
          <label>Start Intelligence +</label>
          <input id="spInt" type="number" min="0" max="30" value="0" />
          <label>Start Strength +</label>
          <input id="spStr" type="number" min="0" max="30" value="0" />
          <label>Start Magic +</label>
          <input id="spMag" type="number" min="0" max="30" value="0" />
        </div>
        <div>
          <label>Start Charm +</label>
          <input id="spCha" type="number" min="0" max="30" value="0" />
          <label>Start Luck +</label>
          <input id="spLuck" type="number" min="0" max="30" value="0" />
          <label>Start Gold +</label>
          <input id="spGold" type="number" min="0" max="200" step="10" value="0" />
          <div class="small">10 gold costs 1 point.</div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="row">
        <button id="btnStart">Begin Life</button>
        <button id="btnResetMeta" class="secondary" title="Clears saved meta points and world progress in this browser.">Reset Meta + World (local)</button>
      </div>
      <div class="small" id="spendStatus"></div>
    </section>

    <section class="card">
      <h2>What Changed in v4</h2>
      <ul class="small" style="margin:8px 0 0 18px; color: var(--muted); line-height:1.55">
        <li><b>Adult age</b> is now <b>16</b> (Boy/Girl becomes Male/Female at 16).</li>
        <li><b>Guild registration</b> is visible everywhere, but requires <b>age 12+</b>.</li>
        <li><b>Hidden content</b>: Actions/quests are hidden until you meet their minimum age (except guild registration).</li>
        <li><b>Kingdom map</b>: You spawn in a random town each life. At 16+, you can <b>travel</b> between towns (10s real time).</li>
        <li><b>Caravan rescues</b>: Rare events can change your long-term story outcomes.</li>
      </ul>
      <div class="divider"></div>
      <div class="small">If something feels too generous or too strict, tell me which part and what you want the expected behavior to be.</div>
    </section>
  </div>

  <div id="screenGame" class="grid" style="display:none">
    <section class="card">
      <h2>Character</h2>
      <div id="charList" class="small"></div>

      <div class="divider"></div>

      <h2>World</h2>
      <div class="small" id="worldLine"></div>

      <div class="divider"></div>

      <h2>Inventory</h2>
      <div class="small">Items you gathered/hunted/mined this life.</div>
      <div id="invList" class="small" style="margin-top:8px"></div>

      <div class="divider"></div>

      <h2>Time & Action</h2>
      <div class="small" id="timeLine"></div>
      <div class="progress" style="margin-top:8px"><div class="bar" id="timeBar"></div></div>

      <div class="divider"></div>

      <h2>Current Task</h2>
      <div class="small" id="taskLine">No task running.</div>
      <div class="progress" style="margin-top:8px"><div class="bar" id="taskBar"></div></div>

      <div class="divider"></div>

      <h2>Queue <span class="small">(max 10)</span></h2>
      <div class="small">Queued actions auto-run when you are idle. Travel removes incompatible queued tasks.</div>
      <div id="queueList"></div>
      <div class="btnRow" style="margin-top:10px">
        <button id="btnClearQueue" class="secondary">Clear Queue</button>
        <button id="btnAgeUp" class="secondary">Age Up (Skip)</button>
      </div>

      <div class="divider"></div>

      <div class="row">
        <button id="btnSave" class="secondary">Save (Local)</button>
        <button id="btnDownload" class="secondary">Save & Download</button>
        <button id="btnLoad" class="secondary">Load</button>
        <input id="fileLoad" type="file" accept="application/json" style="display:none" />
      </div>
      <div class="small">Save (Local) stores state in your browser. Download exports JSON. Load imports JSON.</div>

      <div class="divider"></div>

      <div class="row">
        <button id="btnAbandon" class="danger">End Life (Give Up)</button>
      </div>
      <div class="small">Ends the current run immediately and calculates meta points.</div>
    </section>

    <section class="card">
      <div class="row" style="align-items:flex-start; justify-content:space-between">
        <div>
          <h2>Map</h2>
          <div class="small">Towns, travel (16+), and location actions/quests.</div>
        </div>
        <div class="tabs" id="mapTabs"></div>
      </div>

      <div class="divider"></div>

      <div id="locationPanel"></div>

      <div class="divider"></div>

      <div class="row" style="align-items:center; justify-content:space-between">
        <h2>Log</h2>
        <button id="btnTriggerEvent" class="secondary smallBtn" title="Debug: trigger a caravan event.">Trigger Event</button>
      </div>
      <div class="logFilters" id="logFilters"></div>
      <div class="log" id="log"></div>
    </section>
  </div>
</main>

<div class="modalOverlay" id="modalOverlay">
  <div class="modal">
    <div class="card">
      <h2 id="modalTitle">Life Complete</h2>
      <div id="modalBody" class="small"></div>
      <div class="divider"></div>
      <div class="row">
        <button id="btnRestart">Reincarnate</button>
        <button id="btnCloseModal" class="secondary">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modalOverlay" id="eventOverlay">
  <div class="modal">
    <div class="card">
      <h2 id="eventTitle">Caravan Encounter</h2>
      <div id="eventBody" class="small"></div>
      <div class="divider"></div>
      <div class="btnRow" id="eventOptions"></div>
    </div>
  </div>
</div>

<script type="module" src="js/app.js"></script>
</body>
</html>
